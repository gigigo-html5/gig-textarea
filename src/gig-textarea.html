<link href="../polymer/polymer.html">
<script type="text/javascript">
    var CKEDITOR_BASEPATH = location.pathname+'../ckeditor/';
</script>

<script src="../ckeditor/ckeditor.js"></script>

<script>

    Polymer.GigTextareaEditorBehavior = {
        enableEditor: function() {
            var self = this;

            CKEDITOR.replace(this.$.textarea, {
                language: self.lang,
                uiColor: '#F5F5F5',
                toolbarGroups : self.getConfig(),
                height: self.editorHeight
            });

            this.editorInstance = CKEDITOR.instances.textarea;
            this._editorEvents();
        },
        _editorEvents: function() {
            var self = this;
            self.editorInstance.on( 'contentDom', function() {
                var editable = self.editorInstance.editable();
                editable.attachListener( editable, 'keyup', function() {
                    var data = self.editorInstance.getData();
                    self.$.textarea.value = data;
                    self.value = data;
                    self._checkMaxLength();

                    if (self._getValidity()) {
                        self.errorMessage = null;
                    }
                });

                editable.attachListener( editable, 'focus', function() {
                    self._checkMaxLength();
                });

                editable.attachListener( editable, 'blur', function() {
                    self.maxLengthShow = false;
                });

                editable.attachListener(editable, 'keydown', function() {


                    var str = self.editorInstance.getData().replace(/<[^>]*>|\s/g, '');
                    if (str.length > self.maxlength) {
                        self.editorInstance.setData(str.substring(0, self.maxlength));
                    }
                })
            });
        },
        getConfig: function() {

            switch(this.editorMode) {
                case 'basic':
                return [
                		{ name: 'clipboard', groups: [ 'clipboard', 'undo' ] },
                		{ name: 'editing', groups: [ 'find', 'selection', 'spellchecker', 'editing' ] },
                		{ name: 'links', groups: [ 'links' ] },
                		{ name: 'insert', groups: [ 'insert' ] },
                		{ name: 'forms', groups: [ 'forms' ] },
                		{ name: 'tools', groups: [ 'tools' ] },
                		{ name: 'document', groups: [ 'mode', 'document', 'doctools' ] },
                		{ name: 'others', groups: [ 'others' ] },
                		{ name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },
                		{ name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align', 'bidi', 'paragraph' ] },
                		{ name: 'styles', groups: [ 'styles' ] },
                		{ name: 'colors', groups: [ 'colors' ] }
                	];
                break;
            }
        },
        properties: {
            editorMode: {
                type: String,
                value: 'basic'
            },
            editorHeight: {
                type: Number,
                value: 200
            },
            editorInstance: {
                type: Object
            }
        }
    }
</script>
